
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Chicken&#8217;s Blog ^_^</title>
  <meta name="author" content="codeforfoods">

  
  <meta name="description" content="How To Create a Rails App A step by step guide to prepare your app. First there was “rails new Foo” &ndash; the next thing you know you’re adding “ &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://codeforfoods.net">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Chicken's Blog ^_^" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

<!-- Social media content metadata -->

  



  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-56334390-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Chicken&#8217;s Blog ^_^</a></h1>
  
    <h2>(Just code for food)</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:codeforfoods.net" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/about-me">About Me</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- codeforfoods-footer -->
<ins class="adsbygoogle"
     style="display:inline-block;width:728px;height:90px"
     data-ad-client="ca-pub-4773765193389725"
     data-ad-slot="7439101090"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/12/09/how-to-create-a-rails-app/">[Rails] How to Create a Rails App</a></h1>
    
    
  



  


<span class="byline author vcard"> * source: <span class="fn">



	<a href="http://www.launchacademy.com/codecabulary/learn-rails/how-to-create-a-rails-app">how-to-create-a-rails-app</a>
	

</span></span>
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-12-09T17:14:37+07:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>9</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>5:14 pm</span></time>
        
           | <a href="/blog/2014/12/09/how-to-create-a-rails-app/#disqus_thread"
             data-disqus-identifier="http://codeforfoods.net/blog/2014/12/09/how-to-create-a-rails-app/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h4>How To Create a Rails App</h4>

<h5>A step by step guide to prepare your app.</h5>

<p>First there was “rails new Foo” &ndash; the next thing you know you’re adding “group :test, :development do gem ‘rspec-rails’ end” to your Gemfile and editing your database.yml file to reflect the correct localhost IP. While learning Rails for the first time, it’s difficult to remember these various minutiae of setting up your app; moreover, it’s even more difficult to remember which order they should be performed in. This can often mean running into some time consuming errors along the way. Here is a step by step guide I created, and very often use, to make sure I’m not missing any steps in setting up a working Rails app.</p>

<h4>The 17.5 Steps</h4>

<h5>Step 1</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rails new --database=postgresql OR rails new -T --database=postgresql</span></code></pre></td></tr></table></div></figure>


<p>At Launch Academy we tend to use postgresql. So to save yourself a little extra work, make sure you include the &ndash;database flag when executing rails new.</p>

<p>The -T flag is short for &ndash;skip-test-unit (which is helpful since we usually delete the test directory anyway).</p>

<h5>Step 2</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>remove turbolinks in Rails 4.x -- for Rails 3.x, make sure you remove the public/index.html</span></code></pre></td></tr></table></div></figure>


<p>How to remove Turbolinks:</p>

<pre><code>⋅⋅* Remove the gem 'turbolinks' line from your Gemfile

⋅⋅* Remove the //= require turbolinks from your app/assets/javascripts/application.js.

⋅⋅* Remove the two "data-turbolinks-track" =&gt; true hash key/value pairs from your app/views/layouts/application.html.erb.
</code></pre>

<h5>Step 3</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git init</span></code></pre></td></tr></table></div></figure>


<p>This command sets up your local git repository. You’ll need to do this command first in order to commit your changes later.</p>

<h5>Step 4</h5>

<p>edit config/database.yml</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>host: 127.0.0.1</span></code></pre></td></tr></table></div></figure>


<p>This file holds some settings for your postgresql database. You will probably want to remove the username on your databases. For my system I also needed to add the line host: 127.0.0.1 to make postgresql work.</p>

<h5>Step 5</h5>

<p>Gemfile updates
These are some common gems I’ve used:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gem ‘twitter-bootstrap-rails’
</span><span class='line'>gem ‘simple-form’
</span><span class='line'>
</span><span class='line'>   group :test, :development do
</span><span class='line'>   gem 'rspec-rails'
</span><span class='line'>   gem 'capybara'
</span><span class='line'>   gem 'launchy'
</span><span class='line'>   end
</span><span class='line'>
</span><span class='line'>   group :test do
</span><span class='line'>   gem 'factory_girl_rails'
</span><span class='line'> gem ‘shoulda-matchers’
</span><span class='line'>   end
</span><span class='line'>
</span><span class='line'>   group :development do    #access at rails/routes
</span><span class='line'>   gem 'sextant'
</span><span class='line'>   end</span></code></pre></td></tr></table></div></figure>


<h5>Step 6</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rake db:create</span></code></pre></td></tr></table></div></figure>


<p>I usually do this before bundle, as I’ve run into some errors otherwise. This command creates a local instance of the postgresql database.</p>

<h5>Step 7</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>bundle install</span></code></pre></td></tr></table></div></figure>


<h5>Step 8</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git add * ; git commit -m ‘message’</span></code></pre></td></tr></table></div></figure>


<p>A good chance to commit those changes! git add * will add all changed files to your commit. When you do git commit -m ‘message’, those changes are then saved to your local git repository. This is useful if you ever need to go back to a stable version of your app. This command will also be very important to Git collaboration.</p>

<h5>Step 9</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rails g rspec:install (rails g bootstrap:install static)</span></code></pre></td></tr></table></div></figure>


<p>Install any gem generated scaffolds you may be using. Rspec is a must! Other examples could include bootstrap, or devise.</p>

<h5>Step 10</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>remove ~/test</span></code></pre></td></tr></table></div></figure>


<p>Remove that ~/test dir once you have Rspec setup. A clean app is a happy app. If you used the -T flag while creating the rails app, you can skip this step.</p>

<h5>Step 11</h5>

<p>add to spec_helper.rb</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#spec_helper.rb
</span><span class='line'>  require 'capybara/rails'
</span><span class='line'>  require 'capybara/rspec'
</span><span class='line'>
</span><span class='line'>  config.include FactoryGirl::Syntax::Methods</span></code></pre></td></tr></table></div></figure>


<p>Add this helpful lines to make sure everything works! I like to include the FactoryGirl line as well. That way I don’t have to type FactoryGirl.build, but rather just: build.</p>

<h5>Step 12</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>create factories.rb file in spec/support</span></code></pre></td></tr></table></div></figure>


<p>You’ll need to create the spec/support directory, where you’ll place a new file that will create your factories.</p>

<h5>Step 13</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git add * ; git commit -m ‘message’</span></code></pre></td></tr></table></div></figure>


<p>Commit</p>

<h5>Step 14</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>create models / scaffold / migrations</span></code></pre></td></tr></table></div></figure>


<p>Time to create any generated code. If you’re not using generated code, you can mostly skip to step 16</p>

<h5>Step 15</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git add * ; git commit -m ‘message’</span></code></pre></td></tr></table></div></figure>


<p>Commit before migrating: JUST IN CASE!</p>

<h5>Step 16</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rake db:migrate ; rake db:rollback ; rake db:migrate</span></code></pre></td></tr></table></div></figure>


<p>Use this command to double check that your tables / migrations are correctly configured. This is a best practices sort of deal. If you&rsquo;re using zsh, I&rsquo;d highly recommend making an alias for this command!</p>

<h5>Step 16.5</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rake db:test:prepare</span></code></pre></td></tr></table></div></figure>


<p>This command generates the test environment that Rspec uses. You’ll need to redo this command if you make any new migrations.</p>

<h5>Step 17</h5>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git add * ; git commit -m ‘message’</span></code></pre></td></tr></table></div></figure>


<p>Don’t forget to commit after you Migrate!</p>

<h5>Extras: add database.yml and secret_token.rb to your .gitginore</h5>

<p>This is just a good habit to get into. When others fork your repos, having special database settings can give them a headache when trying to check out your code. Do them a favor and tell git to ignore that file. Another file to add is the secret_token.rb &ndash; it&rsquo;s called that for a reason! It&rsquo;s supposed to be secret! Protect your users by hiding this file.</p>

<p>In your .gitignore file add the lines:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/config/database.yml
</span><span class='line'>/config/secret_token.rb</span></code></pre></td></tr></table></div></figure>


<h6>From here you can do whatever you’d like, and you shouldn’t break your app too much. Have fun!</h6>
</div>
  
  


    </article>
  
  
    <article>
      
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- codeforfoods-footer -->
<ins class="adsbygoogle"
     style="display:inline-block;width:728px;height:90px"
     data-ad-client="ca-pub-4773765193389725"
     data-ad-slot="7439101090"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/12/05/fixing-pg-uniqueviolation-error-duplicate-key-value-violates-unique-constraint-your-table-name-pkey/">Fixing: PG::UniqueViolation: ERROR: Duplicate Key Value Violates Unique Constraint &#8216;Your_table_name_pkey&#8217;</a></h1>
    
    
  



  


<span class="byline author vcard"> * source: <span class="fn">



	<a href="http://blog.thekindof.me/blog/2013/12/05/fixing-pg-uniqueviolation-error-duplicate-key-value-violates-unique-constraint/">fixing-pg-uniqueviolation-error-duplicate-key-value-violates-unique-constraint</a>
	

</span></span>
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-12-05T10:04:09+07:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>5</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>10:04 am</span></time>
        
           | <a href="/blog/2014/12/05/fixing-pg-uniqueviolation-error-duplicate-key-value-violates-unique-constraint-your-table-name-pkey/#disqus_thread"
             data-disqus-identifier="http://codeforfoods.net/blog/2014/12/05/fixing-pg-uniqueviolation-error-duplicate-key-value-violates-unique-constraint-your-table-name-pkey/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h5>Issue</h5>

<p>Postgresql maintain a internal value which is the max value of the id column of a given table. And uses this to generate values for primary keys when you insert new records. Sometimes this internally stored value can get messed up. And that can cause the error above when you are trying to insert a new record to the table.</p>

<h5>How to fix ????</h5>

<p>You need to basically correct the above said value.</p>

<p>Access to your database and run :</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>pg_dump -U user_name database_name -f database_backup_name.sql
</span></code></pre></td></tr></table></div></figure>


<p>Change your rails app and run :</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd /your/rails/app/root/
</span><span class='line'>rails db production</span></code></pre></td></tr></table></div></figure>


<p>Update your_table_id_sql</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>SELECT setval('your_table_id_seq', (SELECT MAX(id) FROM your_table));</span></code></pre></td></tr></table></div></figure>


<p>replace your_table with whatever the table name you are using. And the code above assumes your primary key column name is id.</p>

<p>Good lucks to you :)</p>
</div>
  
  


    </article>
  
  
    <article>
      
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- codeforfoods-footer -->
<ins class="adsbygoogle"
     style="display:inline-block;width:728px;height:90px"
     data-ad-client="ca-pub-4773765193389725"
     data-ad-slot="7439101090"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/12/04/crytal-syntax-and-semantics-part-2/">Crytal: Syntax and Semantics Part 2</a></h1>
    
    
  



  


<span class="byline author vcard"> * source: <span class="fn">



	<a href="http://codeforfoods.net">codeforfoods</a>
	

</span></span>
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-12-04T16:46:54+07:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>4:46 pm</span></time>
        
           | <a href="/blog/2014/12/04/crytal-syntax-and-semantics-part-2/#disqus_thread"
             data-disqus-identifier="http://codeforfoods.net/blog/2014/12/04/crytal-syntax-and-semantics-part-2/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>5.Control expressions</h3>

<h4>5.1.Truthy and falsey values</h4>

<p>A truthy value is a value that is considered true for an if, unless, while or until guard. A falsey value is a value that is considered false in those places.</p>

<p>The only falsey values are nil, false and null pointers (pointers whose memory address is zero). Any other value is truthy.</p>

<h4>5.2.if</h4>

<p>An if evaluates the then branch if its condition is truthy, and evaluates the else branch, if there’s any, otherwise.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>a = 1
</span><span class='line'>if a &gt; 0
</span><span class='line'>  a = 10
</span><span class='line'>end
</span><span class='line'>a #=&gt; 10
</span><span class='line'>
</span><span class='line'>b = 1
</span><span class='line'>if b &gt; 2
</span><span class='line'>  b = 10
</span><span class='line'>else
</span><span class='line'>  b = 20
</span><span class='line'>end
</span><span class='line'>b #=&gt; 20</span></code></pre></td></tr></table></div></figure>


<p>To write a chain of if-else-if you use <em>elsif</em>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>if some_condition
</span><span class='line'>  do_something
</span><span class='line'>elsif some_other_condition
</span><span class='line'>  do_something_else
</span><span class='line'>else
</span><span class='line'>  do_that
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>After an <em>if</em>, a variable’s type depends on the type of the expressions used in both branches.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>a = 1
</span><span class='line'>if some_condition
</span><span class='line'>  a = "hello"
</span><span class='line'>else
</span><span class='line'>  a = true
</span><span class='line'>end
</span><span class='line'># a :: String | Bool
</span><span class='line'>
</span><span class='line'>b = 1
</span><span class='line'>if some_condition
</span><span class='line'>  b = "hello"
</span><span class='line'>end
</span><span class='line'># b :: Int32 | String
</span><span class='line'>
</span><span class='line'>if some_condition
</span><span class='line'>  c = 1
</span><span class='line'>else
</span><span class='line'>  c = "hello"
</span><span class='line'>end
</span><span class='line'># c :: Int32 | String
</span><span class='line'>
</span><span class='line'>if some_condition
</span><span class='line'>  d = 1
</span><span class='line'>end
</span><span class='line'># d :: Int32 | Nil</span></code></pre></td></tr></table></div></figure>


<p>Note that if a variable is declared inside one of the branches but not in the other one, at the end of the <em>if</em> it will also contain the <em>Nil</em> type.</p>

<p>Inside an <em>if</em>&rsquo;s branch the type of a variable is the one it got assigned in that branch, or the one that it had before the branch if it was not reassigned:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>a = 1
</span><span class='line'>if some_condition
</span><span class='line'>  a = "hello"
</span><span class='line'>  # a :: String
</span><span class='line'>  a.length
</span><span class='line'>end
</span><span class='line'># a :: String | Int32</span></code></pre></td></tr></table></div></figure>


<p>That is, a variable’s type is the type of the last expression(s) assigned to it.</p>

<p>If one of the branches never reaches past the end of an <em>if</em>, like in the case of a <em>return</em>, <em>next</em>, <em>break</em> or <em>raise</em>, that type is not considered at the end of the <em>if</em>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>if some_condition
</span><span class='line'>  e = 1
</span><span class='line'>else
</span><span class='line'>  e = "hello"
</span><span class='line'>  # e :: String
</span><span class='line'>  return
</span><span class='line'>end
</span><span class='line'># e :: Int32</span></code></pre></td></tr></table></div></figure>


<h4>5.3.unless</h4>

<p>An <em>unless</em> evaluates the then branch if its condition is falsey, and evaluates the <em>else branch</em>, if there’s any, otherwise. That is, it behaves in the opposite way of an <em>if</em>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>unless some_condition
</span><span class='line'>  then_expression
</span><span class='line'>else
</span><span class='line'>  else_expression
</span><span class='line'>end
</span><span class='line'>
</span><span class='line'># The above is the same as:
</span><span class='line'>if some_condition
</span><span class='line'>  else_expression
</span><span class='line'>else
</span><span class='line'>  then_expression
</span><span class='line'>end
</span><span class='line'>
</span><span class='line'># Can also be written as a suffix
</span><span class='line'>close_door unless door_closed?</span></code></pre></td></tr></table></div></figure>


<h4>5.4.case</h4>

<p>A <em>case</em> is a control expression that allows a sort of pattern matching. It allows writing a chain of if-else-if with a small change in semantic and some more powerful constructs.</p>

<p>In its basic form, it allows matching a value against other values:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ase exp
</span><span class='line'>when value1, value2
</span><span class='line'>  do_something
</span><span class='line'>when value3
</span><span class='line'>  do_something_else
</span><span class='line'>else
</span><span class='line'>  do_another_thing
</span><span class='line'>end
</span><span class='line'>
</span><span class='line'># The above is the same as:
</span><span class='line'>tmp = exp
</span><span class='line'>if value1 === tmp || value2 === tmp
</span><span class='line'>  do_something
</span><span class='line'>elsif value3 === tmp
</span><span class='line'>  do_something_else
</span><span class='line'>else
</span><span class='line'>  do_another_thing
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>Note that <em>===</em> is used for comparing an expression against a <em>case</em>&rsquo;s value.</p>

<p>If a <em>when</em>&rsquo;s expression is a type, <em>is_a</em>? is used. Additionally, if the case expression is a variable or a variable assignment the type of the variable is restricted:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>case var
</span><span class='line'>when String
</span><span class='line'>  # var :: String
</span><span class='line'>  do_something
</span><span class='line'>when Int32
</span><span class='line'>  # var :: Int32
</span><span class='line'>  do_something_else
</span><span class='line'>else
</span><span class='line'>  # here var is neither a String nor an Int32
</span><span class='line'>  do_another_thing
</span><span class='line'>end
</span><span class='line'>
</span><span class='line'># The above is the same as:
</span><span class='line'>if var.is_a?(String)
</span><span class='line'>  do_something
</span><span class='line'>elsif var.is_a?(Int32)
</span><span class='line'>  do_something_else
</span><span class='line'>else
</span><span class='line'>  do_another_thing
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>You can invoke a method on the <em>case</em>&rsquo;s expression in a <em>when</em> by using the implicit-object syntax:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>case num
</span><span class='line'>when .even?
</span><span class='line'>  do_something
</span><span class='line'>when .odd?
</span><span class='line'>  do_something_else
</span><span class='line'>end
</span><span class='line'>
</span><span class='line'># The above is the same as:
</span><span class='line'>tmp = num
</span><span class='line'>if tmp.even?
</span><span class='line'>  do_something
</span><span class='line'>elsif tmp.odd?
</span><span class='line'>  do_something_else
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>Finally, you can ommit the <em>case</em>&rsquo;s value:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>case
</span><span class='line'>when cond1, cond2
</span><span class='line'>  do_something
</span><span class='line'>when cond3
</span><span class='line'>  do_something_else
</span><span class='line'>end
</span><span class='line'>
</span><span class='line'># The above is the same as:
</span><span class='line'>if cond1 || cond2
</span><span class='line'>  do_something
</span><span class='line'>elsif cond3
</span><span class='line'>  do_something_else
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>This sometimes leads to code that is more natural to read.</p>

<h4>5.5.while</h4>

<p>A <em>while</em> executes its body as long as its condition is truthy</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>while some_condition
</span><span class='line'>  do_this
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>In the above form, the condition is first tested and, if truthy, the body is executed. That is, the body might never be executed.</p>

<p>To execute the body at least once and then continue executing it while the condition is truthy, write the while as a prefix:v</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>do_this while some_condition</span></code></pre></td></tr></table></div></figure>


<p>If you need to execute multiple expressions, group them between <em>begin</em> and <em>end</em>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>begin
</span><span class='line'>  do_this
</span><span class='line'>  do_that
</span><span class='line'>end while some_condition</span></code></pre></td></tr></table></div></figure>


<p>A while&rsquo;s type is always Nil.</p>

<p>Similar to an if, if a while&rsquo;s condition is a variable, the variable is guaranteed to not be nil inside the body. If the condition is an var.is_a?(Type) test, var is guaranteed to be of type Type inside the body. And if the condition is a var.responds_to?(:method), var is guaranteed to be of a type that responds to that method.</p>

<p>The type of a variable after a while depends on the type it had before the while and the type it had before leaving the while&rsquo;s body:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>a = 1
</span><span class='line'>while some_condition
</span><span class='line'>  # a :: Int32 | String
</span><span class='line'>  a = "hello"
</span><span class='line'>  # a :: String
</span><span class='line'>  a.length
</span><span class='line'>end
</span><span class='line'># a :: Int32 | String</span></code></pre></td></tr></table></div></figure>


<h4>5.6.until</h4>

<p>An <em>until</em> executes its body until its condition is truthy. An until is just syntax sugar for a while with the condition negated:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>until some_condition
</span><span class='line'>  do_this
</span><span class='line'>end
</span><span class='line'>
</span><span class='line'># The above is the same as:
</span><span class='line'>while !some_condition
</span><span class='line'>  do_this
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>An <em>until</em> can also be used in its suffix form, causing the body to be executed at least once. break and next can also be used inside an until.</p>

<h4>5.7.&amp;&amp;</h4>

<p>An <em>&amp;&amp;</em> (and) evaluates its left hand side. If its truthy, it evaluates its right hand side and has that value. Otherwise it has the value of the left hand side. Its type is the union of the types of both sides.</p>

<p>You can think an <em>&amp;&amp;</em> as syntax sugar of an <em>if</em>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>some_exp1 && some_exp2
</span><span class='line'>
</span><span class='line'># The above is the same as:
</span><span class='line'>tmp = some_exp1
</span><span class='line'>if tmp
</span><span class='line'>  some_exp2
</span><span class='line'>else
</span><span class='line'>  tmp
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<h4>5.8.||</h4>

<p>An <em>||</em> (or) evaluates its left hand side. If its falsey, it evaluates its right hand side and has that value. Otherwise it has the value of the left hand side. Its type is the union of the types of both sides.</p>

<p>You can think an <em>||</em> as syntax sugar of an <em>if</em>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>some_exp1 || some_exp2
</span><span class='line'>
</span><span class='line'># The above is the same as:
</span><span class='line'>tmp = some_exp1
</span><span class='line'>if tmp
</span><span class='line'>  tmp
</span><span class='line'>else
</span><span class='line'>  some_exp2
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>I will present about types and methods in part 3.
Thanks!</p>
</div>
  
  


    </article>
  
  
    <article>
      
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- codeforfoods-footer -->
<ins class="adsbygoogle"
     style="display:inline-block;width:728px;height:90px"
     data-ad-client="ca-pub-4773765193389725"
     data-ad-slot="7439101090"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/12/01/work-with-chef-server/">Work With Chef Server</a></h1>
    
    
  



  


<span class="byline author vcard"> * source: <span class="fn">



	<a href="http://codeforfoods.net">codeforfoods</a>
	

</span></span>
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-12-01T16:44:10+07:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>1</span><span class='date-suffix'>st</span>, <span class='date-year'>2014</span></span> <span class='time'>4:44 pm</span></time>
        
           | <a href="/blog/2014/12/01/work-with-chef-server/#disqus_thread"
             data-disqus-identifier="http://codeforfoods.net/blog/2014/12/01/work-with-chef-server/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In <a href="blog/2014/11/07/php-cooking/">previous post</a> I have wrote how to use Chef Solo to setup and deploy a Server with PHP stuff. Today I&rsquo;d like to use Chef Server for storing Chef&rsquo;s configurations (Cookbooks, Roles, Enviroments, Data Bags) and Bootstrap a server use Chef Server.</p>

<h1>Setup Chef Server</h1>

<p>The easiest way to get started with a Chef server is to use Opscode’s <a href="http://www.opscode.com/hosted-chef/">Hosted Chef</a>–it’s free for up to 5 nodes. Once you exceed 5 nodes you can decide whether to pay a monthly fee or install your own Chef server.</p>

<ul>
<li>Register your free trial of hosted Chef</li>
</ul>


<p><img src="https://lh5.googleusercontent.com/-PeezzBJhRrE/VHwwAKgzq7I/AAAAAAAAABk/OBw78YVf5Mk/w707-h604-no/Sign_Up_-_Chef_Manage.png"></p>

<ul>
<li>Get pem key from profile</li>
</ul>


<p><img src="https://lh6.googleusercontent.com/-_tKhvVNO0u8/VHww8xtE59I/AAAAAAAAABw/O_cbtONexe0/w791-h640-no/Chef_-_Account_Management.png"></p>

<ul>
<li>Generate Knife config</li>
</ul>


<p><img src="https://lh4.googleusercontent.com/-xyw-Lzc3V5Y/VHwzDvnqQwI/AAAAAAAAACY/RJsXXJP_6VY/w710-h640-no/Chef_Manage_and_php-cooking_%E2%80%94_bash_%E2%80%94_162%C3%9730.png"></p>

<ul>
<li>Fork the <code>php-cooking</code> from <a href="blog/2014/11/07/php-cooking/">previous post</a></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>https://github.com/code-for-food/php-cooking.git # fork from github</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p>Move to <code>php-cooking</code> and copy client key and validation key to <code>.chef</code> folder.</p></li>
<li><p>Replace the knife.rb in .chef folder</p></li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">current_dir</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">__FILE__</span><span class="p">)</span>
</span><span class='line'><span class="n">log_level</span>                <span class="ss">:info</span>
</span><span class='line'><span class="n">log_location</span>             <span class="no">STDOUT</span>
</span><span class='line'><span class="n">node_name</span>                <span class="s2">&quot;codeforfoods&quot;</span>
</span><span class='line'><span class="n">client_key</span>               <span class="s2">&quot;</span><span class="si">#{</span><span class="n">current_dir</span><span class="si">}</span><span class="s2">/codeforfoods.pem&quot;</span> <span class="c1"># replace by your key</span>
</span><span class='line'><span class="n">validation_client_name</span>   <span class="s2">&quot;chicken-validator&quot;</span>
</span><span class='line'><span class="n">validation_key</span>           <span class="s2">&quot;</span><span class="si">#{</span><span class="n">current_dir</span><span class="si">}</span><span class="s2">/chicken-validator.pem&quot;</span> <span class="c1"># replace by your key</span>
</span><span class='line'><span class="n">chef_server_url</span>          <span class="s2">&quot;https://api.opscode.com/organizations/chicken&quot;</span>
</span><span class='line'><span class="n">cache_type</span>               <span class="s1">&#39;BasicFile&#39;</span>
</span><span class='line'><span class="n">cache_options</span><span class="p">(</span> <span class="ss">:path</span> <span class="o">=&gt;</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;HOME&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/.chef/checksums&quot;</span> <span class="p">)</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="n">cookbook_path</span>    <span class="o">[</span><span class="s2">&quot;cookbooks&quot;</span><span class="p">,</span> <span class="s2">&quot;site-cookbooks&quot;</span><span class="o">]</span>
</span><span class='line'><span class="n">node_path</span>        <span class="s2">&quot;nodes&quot;</span>
</span><span class='line'><span class="n">role_path</span>        <span class="s2">&quot;roles&quot;</span>
</span><span class='line'><span class="n">environment_path</span> <span class="s2">&quot;environments&quot;</span>
</span><span class='line'><span class="n">data_bag_path</span>    <span class="s2">&quot;data_bags&quot;</span>
</span><span class='line'><span class="n">encrypted_data_bag_secret</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">current_dir</span><span class="si">}</span><span class="s2">/encrypted_data_bag_secret&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p>Upload cookbooks to Chef server</p>

<pre><code>  knife cookbook upload --all
</code></pre></li>
</ul>


<p><img src="https://lh6.googleusercontent.com/-0WxqaSjoQfE/VHw9TgYqHEI/AAAAAAAAACo/qyVX1k3ZFdY/w266-h293-no/php-cooking_%E2%80%94_bash_%E2%80%94_162%C3%9730.png"></p>

<p>View on Chef server</p>

<p><img src="https://lh3.googleusercontent.com/-_jRaxKzYeac/VHw92i4RIYI/AAAAAAAAACw/ybd_zPQg7gA/w775-h591-no/Chef_Manage_and_Picasa_3.png"></p>

<ul>
<li><p>Upload Roles to Chef Server</p>

<pre><code>   knife role from file roles/myapp.json 
   knife role from file roles/myapp_deploy.json
</code></pre></li>
</ul>


<p>View on Server</p>

<p><img src="https://lh6.googleusercontent.com/-ARi99k01P8E/VHw_QKAtUPI/AAAAAAAAAC8/weO6WZ8ub-o/w558-h186-no/Chef_Manage.png"></p>

<ul>
<li>Create new enviroment called <code>staging</code> by create staging.json file in <code>enviroments</code> folder</li>
</ul>


<figure class='code'><figcaption><span>staging.json</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;staging&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;default_attributes&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nt">&quot;apache2&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>      <span class="nt">&quot;listen_ports&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class='line'>        <span class="s2">&quot;80&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;443&quot;</span>
</span><span class='line'>      <span class="p">]</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="nt">&quot;php&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>      <span class="nt">&quot;ext_conf_dir&quot;</span><span class="p">:</span> <span class="s2">&quot;/etc/php5/apache2/conf.d&quot;</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="nt">&quot;myapp&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>      <span class="nt">&quot;user&quot;</span><span class="p">:</span> <span class="s2">&quot;ubuntu&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="nt">&quot;root_path&quot;</span><span class="p">:</span> <span class="s2">&quot;/var/www/codeforfoods&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="nt">&quot;server_name&quot;</span><span class="p">:</span> <span class="s2">&quot;phpdev.codeforfoods.net&quot;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="nt">&quot;json_class&quot;</span><span class="p">:</span> <span class="s2">&quot;Chef::Environment&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nt">&quot;chef_type&quot;</span><span class="p">:</span> <span class="s2">&quot;environment&quot;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p>Upload Enviroments to Chef Server</p>

<pre><code>  knife environment from file environments/dev.json 
  knife environment from file environments/staging.json 
</code></pre></li>
</ul>


<p>View on Server</p>

<p><img src="https://lh4.googleusercontent.com/-kUMwE9lMI1k/VHxAFiJZKcI/AAAAAAAAADE/tVMTf4MMHhQ/w333-h240-no/Chef_Manage.png"></p>

<ul>
<li><p>Create an encrypted data bag</p>

<ul>
<li><p>Create encrypted data bag key, the key would help to decrypted the data bag</p>

<pre><code>  openssl rand -base64 512 | tr -d 'rn' &gt; ~/.chef/encrypted_data_bag_secret
  chmod 600 ~/.chef/encrypted_data_bag_secret
</code></pre></li>
<li><p>Add below line to <code>.chef/knife.rb</code></p>

<pre><code>  encrypted_data_bag_secret "#{current_dir}/encrypted_data_bag_secret"
</code></pre></li>
<li><p>Create the encrypted data bage</p>

<pre><code>   knife data bag create --secret-file ~/.chef/encrypted_data_bag_secret secrets myapp
</code></pre></li>
</ul>


<p>  <img src="https://lh6.googleusercontent.com/--OFW4K4ZuFk/VHxfvrX4DCI/AAAAAAAAADU/SGCTIKaQW9s/w290-h249-no/php-cooking_%E2%80%94_vim_%E2%80%94_162%C3%9730.png"></p>

<p>  View on Server</p>

<p>  <img src="https://lh3.googleusercontent.com/-1W37bGO_9FU/VHxifiyiOCI/AAAAAAAAADg/VsHn4LbYVf4/w958-h421-no/Chef_Manage.png"></p></li>
</ul>


<h1>Setup Vagrant use chef-client as provision</h1>

<figure class='code'><figcaption><span>Vagrantfile</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># -*- mode: ruby -*-</span>
</span><span class='line'><span class="c1"># vi: set ft=ruby :</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Vagrantfile API/syntax version. Don&#39;t touch unless you know what you&#39;re doing!</span>
</span><span class='line'><span class="no">VAGRANTFILE_API_VERSION</span> <span class="o">=</span> <span class="s2">&quot;2&quot;</span>
</span><span class='line'><span class="no">CHEF_PATH</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span>
</span><span class='line'><span class="no">SYNC_PATH</span> <span class="o">=</span> <span class="s2">&quot;./www&quot;</span>
</span><span class='line'><span class="no">Vagrant</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="no">VAGRANTFILE_API_VERSION</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="s2">&quot;ubuntu14.04&quot;</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box_url</span> <span class="o">=</span> <span class="s2">&quot;https://oss-binaries.phusionpassenger.com/vagrant/boxes/latest/ubuntu-14.04-amd64-vbox.box&quot;</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span> <span class="s2">&quot;private_network&quot;</span><span class="p">,</span> <span class="ss">ip</span><span class="p">:</span> <span class="s2">&quot;192.168.34.100&quot;</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">hostname</span> <span class="o">=</span> <span class="s2">&quot;devphp.congdang.com&quot;</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">ssh</span><span class="o">.</span><span class="n">forward_agent</span> <span class="o">=</span> <span class="kp">true</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">ssh</span><span class="o">.</span><span class="n">forward_x11</span>   <span class="o">=</span> <span class="kp">true</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provider</span> <span class="s2">&quot;virtualbox&quot;</span> <span class="k">do</span> <span class="o">|</span><span class="n">vb</span><span class="o">|</span>
</span><span class='line'>    <span class="n">vb</span><span class="o">.</span><span class="n">customize</span><span class="p">(</span><span class="o">[</span><span class="s2">&quot;modifyvm&quot;</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s2">&quot;--natdnshostresolver1&quot;</span><span class="p">,</span> <span class="s2">&quot;off&quot;</span>  <span class="o">]</span><span class="p">)</span>
</span><span class='line'>    <span class="n">vb</span><span class="o">.</span><span class="n">customize</span><span class="p">(</span><span class="o">[</span><span class="s2">&quot;modifyvm&quot;</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s2">&quot;--natdnsproxy1&quot;</span><span class="p">,</span>        <span class="s2">&quot;off&quot;</span>  <span class="o">]</span><span class="p">)</span>
</span><span class='line'>    <span class="n">vb</span><span class="o">.</span><span class="n">customize</span><span class="p">(</span><span class="o">[</span><span class="s2">&quot;modifyvm&quot;</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s2">&quot;--memory&quot;</span><span class="p">,</span>              <span class="s2">&quot;1024&quot;</span> <span class="o">]</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">omnibus</span><span class="o">.</span><span class="n">chef_version</span> <span class="o">=</span> <span class="s1">&#39;11.16.0&#39;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># Your organization name for hosted Chef </span>
</span><span class='line'>  <span class="n">orgname</span> <span class="o">=</span> <span class="s2">&quot;chicken&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># Set the Chef node ID based on environment variable NODE, if set. Otherwise default to vagrant-$USER</span>
</span><span class='line'>  <span class="n">node</span> <span class="o">=</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;NODE&#39;</span><span class="o">]</span>
</span><span class='line'>  <span class="n">node</span> <span class="o">||=</span> <span class="s2">&quot;vagrant-codeforfoods&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="ss">:chef_client</span> <span class="k">do</span> <span class="o">|</span><span class="n">chef</span><span class="o">|</span>
</span><span class='line'>    <span class="n">chef</span><span class="o">.</span><span class="n">chef_server_url</span> <span class="o">=</span> <span class="s2">&quot;https://api.opscode.com/organizations/</span><span class="si">#{</span><span class="n">orgname</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>    <span class="n">chef</span><span class="o">.</span><span class="n">validation_key_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">CHEF_PATH</span><span class="si">}</span><span class="s2">/.chef/</span><span class="si">#{</span><span class="n">orgname</span><span class="si">}</span><span class="s2">-validator.pem&quot;</span>
</span><span class='line'>    <span class="n">chef</span><span class="o">.</span><span class="n">validation_client_name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">orgname</span><span class="si">}</span><span class="s2">-validator&quot;</span>
</span><span class='line'>    <span class="n">chef</span><span class="o">.</span><span class="n">encrypted_data_bag_secret_key_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">CHEF_PATH</span><span class="si">}</span><span class="s2">/.chef/encrypted_data_bag_secret&quot;</span>
</span><span class='line'>    <span class="n">chef</span><span class="o">.</span><span class="n">node_name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>    <span class="n">chef</span><span class="o">.</span><span class="n">provisioning_path</span> <span class="o">=</span> <span class="s2">&quot;/etc/chef&quot;</span>
</span><span class='line'>    <span class="n">chef</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="ss">:debug</span>
</span><span class='line'>    <span class="c1">#chef.log_level = :info</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">chef</span><span class="o">.</span><span class="n">environment</span> <span class="o">=</span> <span class="s2">&quot;dev&quot;</span>
</span><span class='line'>    <span class="n">chef</span><span class="o">.</span><span class="n">add_role</span><span class="p">(</span><span class="s2">&quot;myapp&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">#chef.json.merge!({ :mysql_password =&gt; &quot;foo&quot; }) # You can do this to override any default attributes for this node.</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">synced_folder</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="no">SYNC_PATH</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;/vagrant&quot;</span><span class="p">,</span>
</span><span class='line'>                          <span class="ss">:owner</span> <span class="o">=&gt;</span> <span class="s2">&quot;vagrant&quot;</span><span class="p">,</span>
</span><span class='line'>                          <span class="ss">:group</span> <span class="o">=&gt;</span> <span class="s2">&quot;vagrant&quot;</span><span class="p">,</span>
</span><span class='line'>                          <span class="ss">:mount_options</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="s1">&#39;dmode=777&#39;</span><span class="p">,</span><span class="s1">&#39;fmode=777&#39;</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>Starting <code>Vagrant</code></p>

<pre><code>    vagrant up
</code></pre>

<p>Chef the webapp on browser</p>

<figure class='code'><figcaption><span>Vagrantfile</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">http</span><span class="p">:</span><span class="sr">//</span><span class="mi">192</span><span class="o">.</span><span class="mi">168</span><span class="o">.</span><span class="mi">34</span><span class="o">.</span><span class="mi">100</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<h1>Bootstrap a Server</h1>

<p><a href="http://cloudshare.com">Cloudshare</a> provides a easy way to create new node for testing <a href="http://learn.getchef.com/ubuntu/bootstrap-your-node/">More detail here</a></p>

<ul>
<li>Get a Linux machine to bootstrap</li>
</ul>


<p><img src="https://lh5.googleusercontent.com/-rJtVKEyp_-k/VHx18JYfv0I/AAAAAAAAADw/fECENQ9LPqo/w661-h524-no/Machines.png"></p>

<ul>
<li><p>Bootstrap your node</p>

<pre><code>  knife bootstrap uvo1vinqr3ty38kwnpn.vm.cld.sr -x sysadmin -P Oi9YB7HTfP --sudo -N node1 -r 'role[myapp]' -E staging
</code></pre></li>
</ul>


<p>** If you meet the error while creating the node, please see the comment in this <a href="https://groups.google.com/forum/#!topic/learnchef-fundamentals-webinar/LYe_i_QIWdU">https://groups.google.com/forum/#!topic/learnchef-fundamentals-webinar/LYe_i_QIWdU</a></p>

<p>Error</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>54.79.58.34   knife ssl check -c /etc/chef/client.rb
</span><span class='line'>54.79.58.34 <span class="sb">```</span>
</span><span class='line'>54.79.58.34
</span><span class='line'>54.79.58.34 * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
</span><span class='line'>54.79.58.34
</span><span class='line'>54.79.58.34 Starting Chef Client, version 11.16.4
</span><span class='line'>54.79.58.34
</span><span class='line'>54.79.58.34 <span class="o">================================================================================</span>
</span><span class='line'>54.79.58.34 Chef encountered an error attempting to load the node data <span class="k">for</span> <span class="s2">&quot;testnode&quot;</span>
</span><span class='line'>54.79.58.34 <span class="o">================================================================================</span>
</span><span class='line'>54.79.58.34
</span><span class='line'>54.79.58.34 Authentication Error:
</span><span class='line'>54.79.58.34 ---------------------
</span><span class='line'>54.79.58.34 Failed to authenticate to the chef server <span class="o">(</span>http 401<span class="o">)</span>.
</span><span class='line'>54.79.58.34
</span><span class='line'>54.79.58.34 Server Response:
</span><span class='line'>54.79.58.34 ----------------
</span><span class='line'>54.79.58.34 Failed to authenticate as <span class="s1">&#39;testnode&#39;</span>. Ensure that your node_name and client key are correct.
</span><span class='line'>54.79.58.34
</span><span class='line'>54.79.58.34 Relevant Config Settings:
</span><span class='line'>54.79.58.34 -------------------------
</span><span class='line'>54.79.58.34 chef_server_url   <span class="s2">&quot;https://api.opscode.com/organizations/cd-chef&quot;</span>
</span><span class='line'>54.79.58.34 node_name         <span class="s2">&quot;testnode&quot;</span>
</span><span class='line'>54.79.58.34 client_key        <span class="s2">&quot;/etc/chef/client.pem&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>SSH to server and do this command</p>

<pre><code>    sudo rm -rf /etc/chef/client.pem
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- codeforfoods-footer -->
<ins class="adsbygoogle"
     style="display:inline-block;width:728px;height:90px"
     data-ad-client="ca-pub-4773765193389725"
     data-ad-slot="7439101090"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/11/28/rails-protocol/">Rails Protocol</a></h1>
    
    
  



  


<span class="byline author vcard"> * source: <span class="fn">



	<a href="https://github.com/thoughtbot/guides/tree/master/protocol/rails">rails-protocol</a>
	

</span></span>
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-11-28T10:05:34+07:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>28</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>10:05 am</span></time>
        
           | <a href="/blog/2014/11/28/rails-protocol/#disqus_thread"
             data-disqus-identifier="http://codeforfoods.net/blog/2014/11/28/rails-protocol/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>A guide for writing great web apps.</p>

<h4>Set Up Laptop</h4>

<p>Set up your laptop with :</p>

<ul>
<li><p><a href="https://github.com/thoughtbot/laptop">https://github.com/thoughtbot/laptop</a></p></li>
<li><p><a href="https://github.com/thoughtbot/dotfiles">https://github.com/thoughtbot/dotfiles</a></p></li>
</ul>


<h4>Create App</h4>

<p>Get Suspenders.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gem install suspenders</span></code></pre></td></tr></table></div></figure>


<p>Create the app.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>suspenders app --heroku true --github organization/app</span></code></pre></td></tr></table></div></figure>


<h4>Set Up App</h4>

<p>Get the code</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git clone git@github.com:organization/app.git</span></code></pre></td></tr></table></div></figure>


<p>Set up the app&rsquo;s dependencies</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd project
</span><span class='line'>./bin/setup</span></code></pre></td></tr></table></div></figure>


<p>Use Heroku config to get ENV variables. (<a href="https://github.com/ddollar/heroku-config">https://github.com/ddollar/heroku-config</a>)</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>heroku config:pull --remote staging</span></code></pre></td></tr></table></div></figure>


<p>Delete extra lines in .env, leaving only those needed for app to function properly. For example: BRAINTREE_MERCHANT_ID and S3_SECRET.</p>

<p>Use Foreman to run the app locally (<a href="https://github.com/ddollar/foreman">https://github.com/ddollar/foreman</a>)</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>foreman start</span></code></pre></td></tr></table></div></figure>


<p>It uses your .env file and Procfile to run processes like Heroku&rsquo;s Cedar stack. (<a href="https://devcenter.heroku.com/articles/cedar">https://devcenter.heroku.com/articles/cedar</a>)</p>

<h4>Git protocol</h4>

<p><a href="https://github.com/thoughtbot/guides/tree/master/protocol/git">https://github.com/thoughtbot/guides/tree/master/protocol/git</a></p>

<h4>Product Review</h4>

<p><a href="https://github.com/thoughtbot/guides/tree/master/protocol/product-review">https://github.com/thoughtbot/guides/tree/master/protocol/product-review</a></p>

<h4>Code Review</h4>

<p><a href="https://github.com/thoughtbot/guides/tree/master/code-review">https://github.com/thoughtbot/guides/tree/master/code-review</a></p>

<ul>
<li><p>Review data integrity closely, such as migrations that make irreversible changes to the data, and whether there is a related todo to make a database backup during the staging and production deploys.</p></li>
<li><p>Review SQL queries for potential SQL injection.</p></li>
<li><p>Review whether dependency upgrades include a reason in the commit message, such as a link to the dependency&rsquo;s
ChangeLog or NEWS file.</p></li>
<li><p>Review whether new database indexes are necessary if new columns or SQL queries were added.</p></li>
<li><p>Review whether new scheduler (cron) tasks have been added and whether there is a related todo in the project management system to add it during the staging and production deploys.</p></li>
</ul>


<h4>Deploy</h4>

<p>View a list of new commits. View changed files.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git fetch staging
</span><span class='line'>git log staging/master..master
</span><span class='line'>git diff --stat staging/master</span></code></pre></td></tr></table></div></figure>


<p>If necessary, add new environment variables.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>heroku config:add NEW_VARIABLE=value --remote staging</span></code></pre></td></tr></table></div></figure>


<p>Deploy to Heroku</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git push staging</span></code></pre></td></tr></table></div></figure>


<p>If necessary, run migrations and restart the dynos.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>heroku run rake db:migrate --remote staging
</span><span class='line'>heroku restart --remote staging</span></code></pre></td></tr></table></div></figure>


<p>Introspect to make sure everything&rsquo;s ok.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>watch heroku ps --remote staging</span></code></pre></td></tr></table></div></figure>


<p>Test the feature in browser.</p>

<p>Deploy to production.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git fetch production
</span><span class='line'>git log production/master..master
</span><span class='line'>git diff --stat production/master
</span><span class='line'>heroku config:add NEW_VARIABLE=value --remote production
</span><span class='line'>git push production
</span><span class='line'>heroku run rake db:migrate --remote production
</span><span class='line'>heroku restart --remote production
</span><span class='line'>watch heroku ps --remote production</span></code></pre></td></tr></table></div></figure>


<p>Watch logs and metrics dashboards.</p>

<p>Close pull request and comment Merged.</p>

<h4>Set Up Production Environment</h4>

<ul>
<li><p>Make sure that your Procfile is set up to run Unicorn. (<a href="https://devcenter.heroku.com/articles/procfile">https://devcenter.heroku.com/articles/procfile</a>)</p></li>
<li><p>Make sure the PG Backups add-on is enabled.</p></li>
<li><p>Create a read-only Heroku Follower for your production database. If a Heroku database outage occurs, Heroku can use the follower to get your app back up and running faster. (<a href="https://devcenter.heroku.com/articles/heroku-postgres-follower-databases#high-availability-with-followers">https://devcenter.heroku.com/articles/heroku-postgres-follower-databases#high-availability-with-followers</a>)</p></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- codeforfoods-footer -->
<ins class="adsbygoogle"
     style="display:inline-block;width:728px;height:90px"
     data-ad-client="ca-pub-4773765193389725"
     data-ad-slot="7439101090"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/11/28/scaling-ruby-on-rails-by-caching-your-database-queries/">Scaling Ruby on Rails by Caching Your Database Queries</a></h1>
    
    
  



  


<span class="byline author vcard"> * source: <span class="fn">



	<a href="http://www.codebeerstartups.com/2014/11/scaling-ruby-on-rails-by-caching-your-database-queries/">scaling-ruby-on-rails-by-caching-your-database-queries</a>
	

</span></span>
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-11-28T08:34:54+07:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>28</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>8:34 am</span></time>
        
           | <a href="/blog/2014/11/28/scaling-ruby-on-rails-by-caching-your-database-queries/#disqus_thread"
             data-disqus-identifier="http://codeforfoods.net/blog/2014/11/28/scaling-ruby-on-rails-by-caching-your-database-queries/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This article would help you to scaling your app with caching your database queries.</p>

<p>Its pretty good to use active-record in ruby on rails, relationships, find_by methods, where queries everything makes your life much more simpler as a developer but sooner or later your application becomes slow. At that time you need to work on optimizations. There are lot of work around for optimizations and one of them in caching the queries. The company I work for is StudyPad and we have a product ie splashmath and that has over 9 millions users using it across multiple platforms. The amount of traffic that we get is pretty huge and caching one of the thing that helped us to solve out scaling problems. Here is quick idea to cache your queries in memcache.</p>

<h4>Basic requirements</h4>

<p>There are few requirements for this. First is the dalli gem and memcache installed on your machine.</p>

<h4>Basic structure of the application.</h4>

<p>We have lot of static/seed data which change very less and the queries on those things are pretty high. So first thing to handle that static data.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class Grade &lt; ActiveRecord::Base
</span><span class='line'>  has_many :skills
</span><span class='line'>end
</span><span class='line'>
</span><span class='line'>class Skills &lt; ActiveRecord::Base
</span><span class='line'>  belongs_to :grade
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>So in order to get skills for a grade, its pretty simple</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>grade = Grade.first
</span><span class='line'>skills = grade.skills</span></code></pre></td></tr></table></div></figure>


<p>Now for that matter every time we are fetching skills for a grade its gonna hit the database and get the results. So its time to get this query and its results cached.</p>

<p>Assuming you have configured dalli gem easily and you have memcached up and running. Here is a simple method to cache the results</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>def cached_skills
</span><span class='line'>  Rails.cache.fetch([self.class.name, id, :skills], expires_in: 240.hours) {
</span><span class='line'>    skills.to_a
</span><span class='line'>  }
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>So instead of fetching skills like</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>grade.skills</span></code></pre></td></tr></table></div></figure>


<p>we are gonna get it like</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>grade.cached_skills</span></code></pre></td></tr></table></div></figure>


<p>So whats its gonna do. Its gonna fetch the results first time from the database and store it in cache. Next time its gonna return the results from the cache. Note few things here</p>

<ul>
<li><p>Understand the pattern of the key. [self.class.name, id, :skills] is your key here.</p></li>
<li><p>Cache will expire in 240.hours. You can customize it as per your needs. Better keep a constant for this somewhere in your application.</p></li>
<li><p>In cached_skills methods we are keep records not the active-record relations that why we have to convert into array by using to_a else active-record-relation will be cached and database query will be executed.</p></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>skills.to_a</span></code></pre></td></tr></table></div></figure>


<h4>Expiring the cache.</h4>

<p>We are caching the query results but we are not expiring the results. What if some skill has changed. Grade object is not getting any notification for that, so cache is stale, we need to expire it. So we can write a after_commit hook for skill to expire its grade object’s cache</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># in skill model
</span><span class='line'>after_commit :flush_cache
</span><span class='line'>
</span><span class='line'>def flush_cache
</span><span class='line'>  Rails.cache.delete([self.grade.class.name, self.grade_id, :skills])
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>This is enough to make sure you cache is never stale. There is another way to handle the expiring cache. Lets see that.</p>

<h4>Another way</h4>

<p>We redefine the models like this</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class Grade &lt; ActiveRecord::Base
</span><span class='line'>  has_many :skills
</span><span class='line'>end
</span><span class='line'>
</span><span class='line'>class Skills &lt; ActiveRecord::Base
</span><span class='line'>  belongs_to :grade, touch: true
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>Note we have added touch: true in skills, and now we redefine our cached_skills method again:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>def cached_skills
</span><span class='line'>  Rails.cache.fetch([self.class.name, updated_at.to_i, :skills], expires_in: 240.hours) {
</span><span class='line'>    skills.to_a
</span><span class='line'>  }
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>Now just caching this we don’t need to expire the cache manually, when ever skills get updated it will touch its parent object object grade, that will update its updated_at value and that specific cache will be never used, as key attribute updated_at has been changed.</p>

<h4>The problem with second approach</h4>

<p>But there is a problem. Assume you have 10 different has_many relationships for grade and you are caching it all, now everytime a skill has be changed all the other cache keys for grade relationships will be useless too. For example: Grade has_many topics</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class Grade &lt; ActiveRecord::Base
</span><span class='line'>  has_many :skills
</span><span class='line'>end
</span><span class='line'>
</span><span class='line'>class Skill &lt; ActiveRecord::Base
</span><span class='line'>  belongs_to :grade, touch: true
</span><span class='line'>end
</span><span class='line'>
</span><span class='line'>class Topic &lt; ActiveRecord::Base
</span><span class='line'>  belongs_to :grade, touch: true
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># In Grade model
</span><span class='line'>def cached_skills
</span><span class='line'>  Rails.cache.fetch([self.class.name, updated_at.to_i, :skills], expires_in: 240.hours) {
</span><span class='line'>    skills.to_a
</span><span class='line'>  }
</span><span class='line'>end
</span><span class='line'>
</span><span class='line'>def cached_topics
</span><span class='line'>  Rails.cache.fetch([self.class.name, updated_at.to_i, :topics], expires_in: 240.hours) {
</span><span class='line'>    topics.to_a
</span><span class='line'>  }
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>Now in this case changing any skill will make topics cache useless, but that’s not the case when you are trying to expire it manually. So both approach has pros and cons, first will ask you write more code and second expire cache more frequently. You have to make that choice as per your needs.</p>

<h4>What else?</h4>

<p>Using the same base principle you can cache lot of queries like</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Grade.cached_find_by_id(1)
</span><span class='line'>Skill.first.cached_grade</span></code></pre></td></tr></table></div></figure>


<p>This approach helped us to reduce the load on RDS and make things pretty fast. I hope this will help you too. Let me know you feedback or some tips that made you system more faster</p>
</div>
  
  


    </article>
  
  
    <article>
      
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- codeforfoods-footer -->
<ins class="adsbygoogle"
     style="display:inline-block;width:728px;height:90px"
     data-ad-client="ca-pub-4773765193389725"
     data-ad-slot="7439101090"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/11/27/crytal-syntax-and-semantics-part-1/">Crytal: Syntax and Semantics Part 1</a></h1>
    
    
  



  


<span class="byline author vcard"> * source: <span class="fn">



	<a href="http://codeforfoods.net">codeforfoods</a>
	

</span></span>
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-11-27T17:05:09+07:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>27</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>5:05 pm</span></time>
        
           | <a href="/blog/2014/11/27/crytal-syntax-and-semantics-part-1/#disqus_thread"
             data-disqus-identifier="http://codeforfoods.net/blog/2014/11/27/crytal-syntax-and-semantics-part-1/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>1. Comments</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># This is a comment</span></code></pre></td></tr></table></div></figure>


<h3>2.Local variables</h3>

<p>Local variables start with lowercase letters. They are declared when you first assign them a value.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>name = "Crystal"
</span><span class='line'>age = 1</span></code></pre></td></tr></table></div></figure>


<p>Their type is inferred from their usage, not only from their initializer. In general, they are just value holders associated with the type that the programmer expects them to have according to their location and usage on the program.</p>

<p>For example, reassinging a variable with a different expression makes it have that expression’s type:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>var = "Hello"
</span><span class='line'># At this point 'var' is a String
</span><span class='line'>
</span><span class='line'>var = 1
</span><span class='line'># At this point 'var' is an Int32</span></code></pre></td></tr></table></div></figure>


<p>Underscores are allowed at the beginning of a variable name, but these names are reserved for the compiler, so their use is not recommended (and it also makes the code uglier to read).</p>

<h3>3.Global variables</h3>

<p>Global variables start with a dollar sign ($). They are declared when you first assign them a value.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$year = 2014</span></code></pre></td></tr></table></div></figure>


<p>Their type is the combined type of all expressions that were assigned to them. Additionally, if you program reads a global variable before it was ever assigned a value it will also have the Nil type.</p>

<h3>4.Assignment</h3>

<p>Assignment is done with the equal (=) character.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Assigns to a local variable
</span><span class='line'>local = 1
</span><span class='line'>
</span><span class='line'># Assigns to an instance variable
</span><span class='line'>@instance = 2
</span><span class='line'>
</span><span class='line'># Assigns to a class variable
</span><span class='line'>@@class = 3
</span><span class='line'>
</span><span class='line'># Assigns to a global variable
</span><span class='line'>$global = 4</span></code></pre></td></tr></table></div></figure>


<p>Some syntax sugar that contains the = character is available:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>local += 1  # same as: local = local + 1
</span><span class='line'>
</span><span class='line'># The above is valid with these operators:
</span><span class='line'># +, -, *, /, %, |, &, ^, **, &lt;&lt;, &gt;&gt;
</span><span class='line'>
</span><span class='line'>local ||= 1 # same as: local || (local = 1)
</span><span class='line'>local &&= 1 # same as: local && (local = 1)</span></code></pre></td></tr></table></div></figure>


<p>A method invocation that ends with = has syntax sugar:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># A setter
</span><span class='line'>person.name=("John")
</span><span class='line'>
</span><span class='line'># The above can be written as:
</span><span class='line'>person.name = "John"
</span><span class='line'>
</span><span class='line'># An indexed assignment
</span><span class='line'>objects.[]=(2, 3)
</span><span class='line'>
</span><span class='line'># The above can be written as:
</span><span class='line'>objects[2] = 3
</span><span class='line'>
</span><span class='line'># Not assignment-related, but also syntax sugar:
</span><span class='line'>objects.[](2, 3)
</span><span class='line'>
</span><span class='line'># The above can be written as:
</span><span class='line'>objects[2, 3]</span></code></pre></td></tr></table></div></figure>


<p>The = operator syntax sugar is also available to setters and indexers. Note that || and &amp;&amp; use the []? method to check for key prescence.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>person.age += 1        # same as: person.age = person.age + 1
</span><span class='line'>
</span><span class='line'>person.name ||= "John" # same as: person.name || (person.name = "John")
</span><span class='line'>person.name &&= "John" # same as: person.name && (person.name = "John")
</span><span class='line'>
</span><span class='line'>objects[1] += 2        # same as: objects[1] = objects[1] + 2
</span><span class='line'>
</span><span class='line'>objects[1] ||= 2       # same as: objects[1]? || (objects[1] = 2)
</span><span class='line'>objects[1] &&= 2       # same as: objects[1]? && (objects[1] = 2)</span></code></pre></td></tr></table></div></figure>


<p>I will present about control expressions in part 2.
Thanks!</p>
</div>
  
  


    </article>
  
  
    <article>
      
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- codeforfoods-footer -->
<ins class="adsbygoogle"
     style="display:inline-block;width:728px;height:90px"
     data-ad-client="ca-pub-4773765193389725"
     data-ad-slot="7439101090"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/11/27/crystal-getting-started/">Crystal: Getting Started</a></h1>
    
    
  



  


<span class="byline author vcard"> * source: <span class="fn">



	<a href="http://codeforfoods.net">codeforfoods</a>
	

</span></span>
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-11-27T16:43:51+07:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>27</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>4:43 pm</span></time>
        
           | <a href="/blog/2014/11/27/crystal-getting-started/#disqus_thread"
             data-disqus-identifier="http://codeforfoods.net/blog/2014/11/27/crystal-getting-started/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Introduction:</h3>

<p>Crystal is a programming language that resembles Ruby but compiles to native code and tries to be much more efficient, at the cost of disallowing certain dynamic aspects of Ruby.</p>

<h3>Installation</h3>

<h4>1. On Debian and Ubuntu</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>curl http://dist.crystal-lang.org/apt/setup.sh | sudo bash
</span><span class='line'>apt-key adv --keyserver keys.gnupg.net --recv-keys 09617FD37CC06B54
</span><span class='line'>echo "deb http://dist.crystal-lang.org/apt crystal main" &gt; /etc/apt/sources.list.d/crystal.list
</span><span class='line'>sudo apt-get install crystal</span></code></pre></td></tr></table></div></figure>


<h4>2. On Mac OSX using Homebrew</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>brew tap manastech/crystal
</span><span class='line'>brew install crystal</span></code></pre></td></tr></table></div></figure>


<h3>Hello World</h3>

<p>This is the simplest way to write the Hello World program in Crystal:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>puts "Hello World"</span></code></pre></td></tr></table></div></figure>


<p>First create a file hello.cr containing your code. Then type in the console:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>chmod +x hello.cr
</span><span class='line'>crystal hello.cr</span></code></pre></td></tr></table></div></figure>


<p>That&rsquo;s all! Hope you guys love it :D
I will have another post about syntax and semantics :)
Thanks</p>
</div>
  
  


    </article>
  
  
    <article>
      
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- codeforfoods-footer -->
<ins class="adsbygoogle"
     style="display:inline-block;width:728px;height:90px"
     data-ad-client="ca-pub-4773765193389725"
     data-ad-slot="7439101090"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/11/19/rails-get-youtube-download-link/">[Rails] Get Youtube Download Link</a></h1>
    
    
  



  


<span class="byline author vcard"> * source: <span class="fn">



	<a href="https://github.com/rb2k/viddl-rb">viddl-rb</a>
	

</span></span>
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-11-19T08:39:56+07:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>19</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>8:39 am</span></time>
        
           | <a href="/blog/2014/11/19/rails-get-youtube-download-link/#disqus_thread"
             data-disqus-identifier="http://codeforfoods.net/blog/2014/11/19/rails-get-youtube-download-link/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>Installation:</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gem install viddl-rb
</span></code></pre></td></tr></table></div></figure>


<h3>Usage:</h3>

<p>Download a video: viddl-rb <a href="http://www.youtube.com/watch?v=QH2-TGUlwu4">http://www.youtube.com/watch?v=QH2-TGUlwu4</a>
<br>
Viddl-rb supports the following command line options:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>-e, --extract-audio              Extract the audio track of the download to a separate file
</span><span class='line'>-a, --abort-on-failure           Abort if one of the videos in a list fails to download
</span><span class='line'>-u, --url-only                   Just display the download url without downloading the file.
</span><span class='line'>-t, --title-only                 Just display the title without downloading the file.
</span><span class='line'>-f, --filter REGEX               Filters a video playlist according to the regex (Youtube only right now)
</span><span class='line'>-s, --save-dir DIRECTORY         Specifies the directory where videos should be saved
</span><span class='line'>-d, --downloader TOOL            Specifies the tool to download with. Supports 'wget', 'curl', 'aria2c' and 'net-http'
</span><span class='line'>-q, --quality QUALITY            Specifies the video format and resolution in the following way: width:height:format (e.g. 1280:720:mp4)
</span><span class='line'>                                 The width, height and format may be omitted with a *.
</span><span class='line'>                                 For example, to match any quality with a height of 720 pixels in any format specify --quality *:720:*
</span><span class='line'>-h, --help                       Displays the help screen</span></code></pre></td></tr></table></div></figure>


<h3>Library Usage:</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>require 'viddl-rb'
</span><span class='line'>
</span><span class='line'>download_urls = ViddlRb.get_urls("http://www.youtube.com/watch?v=QH2-TGUlwu4")
</span><span class='line'>download_urls.first     # =&gt; "http://o-o.preferred.arn06s04.v3.lscac ..."</span></code></pre></td></tr></table></div></figure>


<p>The ViddlRb module has the following module public methods:</p>

<h4>get_urls_names(url)</h4>

<p> &ndash; Returns an array of one or more hashes that has the keys :url which points to the download url and :name which points to the name (which is a filename safe version of the video title with a file extension). Returns nil if the url is not recognized by any plugins.</p>

<h4>get_urls_exts(url)</h4>

<p>&ndash; Same as get_urls_names but with just the file extension (for example &ldquo;.mp4&rdquo;) instead of the full filename, and the :name key is replaced with :ext. Returns nil if the url is not recognized by any plugins.</p>

<h4>get_urls(url)</h4>

<p>&ndash; Returns an array of download urls for the specified video url. Returns nil if the url is not recognized by any plugins.</p>

<h4>get_names(url)</h4>

<p>&ndash; Returns an array of filenames for the specified video url. Returns nil if the url is not recognized by any plugins.</p>

<h4>io=(io_object)</h4>

<p>&ndash; By default all plugin output to stdout will be suppressed when the library is used. If you are interested in the output of a plugin, you can set an IO object that will receive all plugin output using this method.</p>

<h3>Requirements:</h3>

<blockquote><ul>
<li>curl/wget/aria2c or the progress bar gem</li>
<li>Nokogiri</li>
<li>ffmpeg if you want to extract audio tracks from the videos</li>
</ul>
</blockquote>
</div>
  
  


    </article>
  
  
    <article>
      
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- codeforfoods-footer -->
<ins class="adsbygoogle"
     style="display:inline-block;width:728px;height:90px"
     data-ad-client="ca-pub-4773765193389725"
     data-ad-slot="7439101090"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/11/18/let-flood-test-your-site-with-flood-dot-io/">Let Flood Test Your Site With Flood.io</a></h1>
    
    
  



  


<span class="byline author vcard"> * source: <span class="fn">



	<a href="https://flood.io/help/floods/getting_started_using_jmeter">flood.io</a>
	

</span></span>
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-11-18T23:45:08+07:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>18</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>11:45 pm</span></time>
        
           | <a href="/blog/2014/11/18/let-flood-test-your-site-with-flood-dot-io/#disqus_thread"
             data-disqus-identifier="http://codeforfoods.net/blog/2014/11/18/let-flood-test-your-site-with-flood-dot-io/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Flood IO is a cloud based load testing platform for <a href="https://flood.io/help/floods/jmeter.apache.org">JMeter</a> and <a href="https://flood.io/help/floods/gatling-tool.org">Gatling</a> that lets you scale out your tests across the globe using our on demand or your own hosted AWS infrastructure. In this article we introduce you to JMeter and how to run your first Flood test.</p>

<p>In this article, I&rsquo;d like to use <code>JMeter</code> as testing scripts</p>

<h3>Getting JMeter</h3>

<p>JMeter can be downloaded <a href="http://jmeter.apache.org/download_jmeter.cgi">here</a> and typically you can start JMeter using the <code>jmeter.cmd</code> or <code>jmeter.sh</code> scripts located in the downloaded archive <code>bin</code> directory.</p>

<p><img src="https://s3.amazonaws.com/flood-io-support/jmeter-example.jmx_UserstimkoopmansGitfloodflood-sitepublicjmeter-example.jmx_-_Apache_JMeter_2.11_r1554548_2014-10-06_17-37-40.jpg"></p>

<h3>Creating a Test Plan</h3>

<p>Once you have created a <a href="https://flood.io/jmeter-example.jmx">basic test plan</a> and saved it locally as a <code>.jmx</code> file, you can upload this to Flood IO to create your first Flood test.</p>

<h3>Creating a Flood Test</h3>

<p>After you login to Flood IO you can click the &ldquo;+&rdquo; icon or from your <a href="https://flood.io/dashboard/floods">Floods dashboard</a> you can click the &ldquo;Create Flood&rdquo; button to create a new Flood.</p>

<p><img src="https://s3.amazonaws.com/flood-io-support/Flood_IO_2014-10-06_17-36-50.jpg"></p>

<p>In the new Flood form, add the <code>.jmx</code> test plan you created using JMeter to the Files input and select a Grid to run your Flood test on. You can optionally set the &ldquo;Name&rdquo; or &ldquo;Tags&rdquo; to help identify the test in your dashboard.</p>

<p><img src="https://s3.amazonaws.com/flood-io-support/Flood_IO_2014-10-06_17-49-17.jpg"></p>

<h3>Start your Flood Test</h3>

<p>Read about more [advanced settings] or simply click the &ldquo;Start Flood&rdquo; button to launch your test.</p>

<p><img src="https://s3.amazonaws.com/flood-io-support/Flood_IO_2014-10-06_17-53-22.jpg"></p>

<p>You will be redirected to a Flood report which will show you results in real time from the test you just executed on the chosen Grid.</p>

<h3>The results in real time</h3>

<ul>
<li>Summary about AVG Response Time, Concurence Users and Transaction Rate</li>
</ul>


<p><img src="https://lh3.googleusercontent.com/-cbQyegUkAt8/VGt77yF3o_I/AAAAAAAAADE/zIceQUvDRnY/w957-h199-no/Flood_IO.png"></p>

<ul>
<li>Summary report by chart</li>
</ul>


<p><img src="https://lh3.googleusercontent.com/-LdsF3ANppGY/VGt8J5PJa3I/AAAAAAAAADM/dN75wBnBQ7M/w958-h404-no/Flood_IO.png"></p>

<ul>
<li>Detail transaction</li>
</ul>


<p><img src="https://lh3.googleusercontent.com/-NLjHvr3TwME/VGt8m92lEoI/AAAAAAAAADc/9o8vDRsEzBE/w957-h384-no/Flood_IO.png"></p>

<ul>
<li>You can trace your http connection</li>
</ul>


<p><img src="https://lh3.googleusercontent.com/ItYy1EO4CTEt8fFFxFNKxkwdgR9uey33boD5RZ_MyA=w400-h207-p-no"></p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/2">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section class="gravatar-section first odd">
  <h1>We are</h1>
  <div class="bio">
    <div class="messages">
      <p><a href="https://codeforfoods.net"><strong>@CodeForFoods</strong></a></p>
      <p>we are web developers</p>
      <p>in Viet Nam</p>
      <a href="/about-us">More</a>
    </div>
  </div>
  <div class="gravatar">
    <img src="https://avatars3.githubusercontent.com/u/9510217?v=2&s=400" alt="Github avarta of code for food" title="Github avarta of code for food">
  </div>
</section><section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/12/09/how-to-create-a-rails-app/">[Rails] How to Create a Rails App</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/12/05/fixing-pg-uniqueviolation-error-duplicate-key-value-violates-unique-constraint-your-table-name-pkey/">Fixing: PG::UniqueViolation: ERROR: Duplicate Key Value Violates Unique Constraint &#8216;Your_table_name_pkey&#8217;</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/12/04/crytal-syntax-and-semantics-part-2/">Crytal: Syntax and Semantics Part 2</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/12/01/work-with-chef-server/">Work With Chef Server</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/11/28/rails-protocol/">Rails Protocol</a>
      </li>
    
  </ul>
</section>
<section>
	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- codeforfoods -->
	<ins class="adsbygoogle"
	     style="display:inline-block;width:260px;height:260px"
	     data-ad-client="ca-pub-4773765193389725"
	     data-ad-slot="3148502299"></ins>
	<script>
	(adsbygoogle = window.adsbygoogle || []).push({});
	</script>
</section>
<section>
  <h1>On Delicious</h1>
  <div id="delicious"></div>
  <script type="text/javascript" src="http://feeds.delicious.com/v2/json/codeforfoods?count=3&amp;sort=date&amp;callback=renderDeliciousLinks"></script>
  <p><a href="http://delicious.com/codeforfoods">My Delicious Bookmarks &raquo;</a></p>
</section>


<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/code.for.food.14?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - codeforfoods -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'codeforfoods';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=288370854684839&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
